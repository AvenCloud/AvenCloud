# Migration `20201116185312-account-emails`

This migration has been generated by Eric Vicenti at 11/16/2020, 10:53:12 AM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "EmailValidation" ADD COLUMN     "userId" INTEGER

CREATE TABLE "VerifiedEmail" (
    "email" TEXT NOT NULL,
    "verifyTime" TIMESTAMP(3) NOT NULL DEFAULT CURRENT_TIMESTAMP,
    "userId" INTEGER NOT NULL,

    PRIMARY KEY ("email")
)

ALTER TABLE "VerifiedEmail" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "EmailValidation" ADD FOREIGN KEY("userId")REFERENCES "User"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201114042833-cleanup-pw-col..20201116185312-account-emails
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -21,18 +21,29 @@
   publicBio           String?
   Comment             Comment[]
   Clip                Clip[]
-  Sites Site[]
+  Sites           Site[]
+  EmailValidation EmailValidation[]
+  VerifiedEmail   VerifiedEmail[]
 }
 model EmailValidation {
   id        Int      @id @default(autoincrement())
   emailTime DateTime @default(now())
   email     String
   secret    String   @unique
+  userId    Int?
+  user      User?    @relation(fields: [userId], references: [id])
 }
+model VerifiedEmail {
+  email      String   @id
+  verifyTime DateTime @default(now())
+  userId     Int
+  user       User     @relation(fields: [userId], references: [id])
+}
+
 model PhoneValidation {
   id       Int      @id @default(autoincrement())
   sendTime DateTime @default(now())
   phone    String
```


