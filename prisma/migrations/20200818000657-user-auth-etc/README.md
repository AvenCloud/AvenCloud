# Migration `20200818000657-user-auth-etc`

This migration has been generated by Eric Vicenti at 8/17/2020, 5:06:57 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Session" DROP CONSTRAINT "Session_userId_fkey"

ALTER TABLE "public"."Session" DROP COLUMN "userId",
ADD COLUMN "verifiedUserId" integer   ,
ADD COLUMN "validationToken" text   ,
ADD COLUMN "unvalidatedEmail" text   ;

ALTER TABLE "public"."User" ADD COLUMN "passwordSalt" text   ,
ADD COLUMN "passwordHash" text   ,
ADD COLUMN "stripeCustomerId" text   ,
ADD COLUMN "giftedAccess" integer  NOT NULL DEFAULT 0,
ADD COLUMN "subscribedAccess" integer  NOT NULL DEFAULT 0;

ALTER TABLE "public"."Session" ADD FOREIGN KEY ("verifiedUserId")REFERENCES "public"."User"("id") ON DELETE SET NULL ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20200815173550-init..20200818000657-user-auth-etc
--- datamodel.dml
+++ datamodel.dml
@@ -1,23 +1,30 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
 }
 model Session {
-  id        Int      @default(autoincrement()) @id
-  createdAt DateTime @default(now())
-  user      User     @relation(fields: [userId], references: [id])
-  userId    Int
+  id               Int      @default(autoincrement()) @id
+  createdAt        DateTime @default(now())
+  verifiedUser     User?    @relation(fields: [verifiedUserId], references: [id])
+  verifiedUserId   Int?
+  validationToken  String?
+  unvalidatedEmail String?
 }
 model User {
-  id       Int       @default(autoincrement()) @id
-  username String    @unique
-  email    String    @unique
-  name     String?
-  sessions Session[]
+  id               Int       @default(autoincrement()) @id
+  username         String    @unique
+  email            String    @unique
+  name             String?
+  sessions         Session[]
+  passwordSalt     String?
+  passwordHash     String?
+  stripeCustomerId String?
+  giftedAccess     Int       @default(0)
+  subscribedAccess Int       @default(0)
 }
```


