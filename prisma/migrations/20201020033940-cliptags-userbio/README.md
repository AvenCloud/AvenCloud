# Migration `20201020033940-cliptags-userbio`

This migration has been generated by Eric Vicenti at 10/19/2020, 8:39:40 PM.
You can check out the [state of the schema](./schema.prisma) after the migration.

## Database Steps

```sql
ALTER TABLE "public"."Clip" ADD COLUMN "caption" text   

ALTER TABLE "public"."User" ADD COLUMN "publicBio" text   

CREATE TABLE "public"."Tag" (
"id" text   NOT NULL ,
PRIMARY KEY ("id")
)

CREATE TABLE "public"."ClipTag" (
"clipId" integer   NOT NULL ,
"tagId" text   NOT NULL 
)

CREATE UNIQUE INDEX "ClipTag_id" ON "public"."ClipTag"("clipId", "tagId")

ALTER TABLE "public"."ClipTag" ADD FOREIGN KEY ("clipId")REFERENCES "public"."Clip"("id") ON DELETE CASCADE ON UPDATE CASCADE

ALTER TABLE "public"."ClipTag" ADD FOREIGN KEY ("tagId")REFERENCES "public"."Tag"("id") ON DELETE CASCADE ON UPDATE CASCADE
```

## Changes

```diff
diff --git schema.prisma schema.prisma
migration 20201019041320-clip-publish..20201020033940-cliptags-userbio
--- datamodel.dml
+++ datamodel.dml
@@ -1,7 +1,7 @@
 datasource db {
   provider = "postgresql"
-  url = "***"
+  url = "***"
 }
 generator client {
   provider = "prisma-client-js"
@@ -18,8 +18,9 @@
   stripeCustomerId    String?
   giftedAccess        Int       @default(0)
   subscribedAccess    Int       @default(0)
   subscriptionEndTime DateTime?
+  publicBio           String?
   Comment             Comment[]
   Clip                Clip[]
 }
@@ -51,5 +52,21 @@
   draftTime   DateTime  @default(now())
   publishTime DateTime?
   userId      Int
   user        User      @relation(fields: [userId], references: [id])
+  caption     String?
+  tags        ClipTag[]
 }
+
+model Tag {
+  id      String    @id
+  ClipTag ClipTag[]
+}
+
+model ClipTag {
+  clipId Int
+  clip   Clip   @relation(fields: [clipId], references: [id])
+  tagId  String
+  tag    Tag    @relation(fields: [tagId], references: [id])
+
+  @@unique([clipId, tagId], name: "ClipTag_id")
+}
```


